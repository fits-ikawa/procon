# procon
Paiza や AtCoder などのオンラインジャッジのコーディングをローカル環境で行うための簡易テストツールです。ブラウザ上のエディタが貧弱すぎる、任意の内容のテストケースを試せないなどの問題をゆるく解決します。

## 前提条件
- Windows で WSL + Visual Studio Code を使用している

以下、WSL 環境に
- Git がインストールされている
- Python がインストールされている（3.10 以降推奨）
  - 加えて、以下のコマンドで pip パッケージをインストールしておいてください
```sh
pip install fabric watchdog pyyaml
```
- JavaScript, TypeScript でコーディングする場合、Node.js がインストールされている
- Rust でコーディングする場合、Rust がインストールされている
- C++ でコーディングする場合、build-essential がインストールされている
  - `sudo apt update && sudo apt install build-essential`

現状ではコンテナ化など行っておらず、使用したい言語の処理系をローカル環境に直接インストールしておく必要があります。各言語のインストール方法は `WSL Ubuntu Node.js インストール` のようなキーワードで検索してみてください。

## 導入方法
WSL 上の任意のディレクトリに移動し、このリポジトリを clone します

```sh
git clone https://github.com/fits-ikawa/procon.git
```

TypeScript でコーディングする場合は、次のコマンドも実行してください。

```sh
cd procon
npm install typescript @types/node
```

## 使い方
### 1. VSCode で WSL にアタッチし、リポジトリのディレクトリを開きます
### 2. Paiza や AtCoder で、取り組みたい問題のページを開きます
### 3. 以下のコマンドでツールを起動します
```sh
fab procon [使用言語] [作業ディレクトリ]
```

- 対応言語: `python` `javascript` `typescript` `rust` `cpp`

例えば JavaScript で Paiza の B010 問題に取り組むなら、
- `fab procon javascript work/paiza/b/b010`

例えば Python で AtCoder の ABC 112 B 問題に取り組むなら、
- `fab procon python work/atcoder/abc/112/b`

など。制限時間を気にする場合は 2 と 3 の手順を逆にしてください。

ツールを起動すると、ソースコード（solve.*）とテストケース（cases.txt）のファイルが VSCode で自動的に開かれます。

### 4. 問題のテストケース（入出力例）を cases.txt にコピペして整形します
```
入力ケース1
(空行)
出力ケース1
(空行)
入力ケース2
(空行)
出力ケース2
(空行)
...
```
となるように手動でコピペ＆整形してください。アナログですみません……。

例として、[AtCoder ABC 112 B](https://atcoder.jp/contests/abc112/tasks/abc112_b) 問題のテストケースは、そのまま一気にコピペすると以下のようになります。
```
入力例 1
Copy
3 70
7 60
1 80
4 50
出力例 1
Copy
4
1 番目の経路を使うと、コスト
7 で帰宅できます
2 番目の経路では時間
T=70 以内に帰宅できません
3 番目の経路を使うと、コスト
4 で帰宅できます
従って、
3 番目の経路を使ったときのコスト
4 が最小です。

入力例 2
Copy
4 3
1 1000
2 4
3 1000
4 500
出力例 2
Copy
TLE
どの経路を使っても時間
T=3 以内に帰宅できません。

入力例 3
Copy
5 9
25 8
5 9
4 10
1000 1000
6 1
出力例 3
Copy
5
```

それを手動で編集して以下のように整形します。1 ケースずつコピペしていく方法でも構いません。
```
3 70
7 60
1 80
4 50

4

4 3
1 1000
2 4
3 1000
4 500

TLE

5 9
25 8
5 9
4 10
1000 1000
6 1

5
```

テストケースのタブは Split Right してソースコードと並べて表示しておくと作業しやすいです。


### 5. 実装を進めます
ソースコード（solve.*）上で `paiza` と入力すると Paiza 用のテンプレートを呼び出せます。テンプレートの内容を変更したい場合は .vscode/\*.code-snippets を編集してください（ほぼ毎回書くような処理はテンプレートに入れていきましょう）。

以降、ソースコード（solve.*）かテストケース（cases.txt）の内容が更新される度に、自動で
- 入力ケースを標準入力としてコード実行
- 実行結果の標準出力を出力ケースと比較

をケース数ぶん繰り返し、最後に結果を一覧で表示します。結果には以下の種類があります。
- `AC`: テスト成功（Accepted）
- `WA`: テスト失敗（Wrong Answer）
- `SK`: スキップ（コード実行もしない）
- `DC`: コードは実行したが正誤判定をスキップ（後述の #dontcare を参照）

すべてが `AC` になるまで実装します。

**難しい問題、複雑な問題では自分でコーナーケースなどの入出力をテストケースに書き足し、追加のテストを行いましょう。**

また、プログラムが無限ループに陥った場合を考慮して 10 秒でタイムアウトするように作っていますが、ハングアップの仕方によっては 10 秒を超えても帰ってこなくなるようなので、その場合は Ctrl+C でツールを終了し、再度起動してください。

### 6. 完成したコードをオンラインジャッジのサイトに提出します
ジャッジに失敗した場合は 5 に戻ります。

#### Paiza に TypeScript のコードを提出する
Paiza は TypeScript に直接対応していないので、`作業ディレクトリ/dist` に出力されている、変換後の JavaScript の内容を提出してください。

### 7. ツールを終了します
コンソールの `cmd >>` というプロンプトに `q` `Enter` と入力するか、Ctrl+C でツールを終了できます。別の問題に取り組みたい場合は 2 に戻ってください。

## テストケースで使えるコマンド
テストを効率的に進めるため、テストケースにいくつかの特殊な指定が可能です。

### #pick
入力ケースの行頭に書くと、そのケースのみ実行します。`#pick` が複数ある場合、`#pick` が指定されたケースのみ実行していきます。ひとつの問題に集中してデバッグしたい場合などに使います。

### #skip
入力ケースの行頭に書くと、そのケースをスキップします。

### #skipbelow
入力ケースの行頭に書くと、そのケース以降をスキップします。

### #dontcare
出力ケースとして書くと、そのケースでは正誤判定を行いません。ある入力を試したいが、それに対応する出力ケースが分からないときに指定します。例えば「入力の N が大きい時にプログラムがハングアップしないかどうかだけ確認したい場合」などを想定したものです。

### #blank
期待出力が空行の場合、出力ケースとして `#blank` を指定してください。

## Note
- 稀に「期待する出力結果は浮動小数点数値で誤差 0.000001 以内」のような問題がありますが、このツールはテキストとしての一致でしか正誤判定を行っていないので、そのような場合は目視で誤差の範囲内になっているか確認してください。
- lib ディレクトリは再利用可能なコードスニペットの保存用に用意されているものです。例えばグラフ問題を解くのに実装した汎用的な関数を lib/javascript/graph.js ファイルに保存しておく、といった使い方を想定しています。
- ローカルにインストールした言語環境と、Paiza 等がジャッジに使用している環境は基本的に異なることを軽く気に留めておいてください。厳密に合わせるほどのことではないですが。
  - 参考: [各言語のバージョン、環境情報 (Paiza)](https://paiza.jp/guide/language)
- このリポジトリは fork したり、自分のアカウント等に public として上げ直してもらって構いません。ただし、Paiza の提出コードやテストケースはコミットしないようにしましょう。規約違反になる可能性があります。
- AtCoder については他にスタンダードで高機能なツール（atcoder-cli, online-judge-tools）があるため、本格的に取り組みたい場合はそちらも調べてみてください。
